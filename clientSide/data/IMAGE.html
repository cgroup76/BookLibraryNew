<!<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <svg class="bubble-head-left-s" viewBox="0 0 200 200" xmlns="http://www.w3.org/2000/svg">
        <path fill="#FF0066" d="M42.5,-69C54.3,-66.7,62.8,-53.9,71.7,-40.7C80.7,-27.4,90.1,-13.7,80.6,-5.5C71.1,2.7,42.6,5.5,29.9,12.2C17.2,18.9,20.2,29.5,17.8,42.6C15.5,55.6,7.7,71.1,-3.3,76.8C-14.4,82.6,-28.8,78.7,-41.7,71.7C-54.5,64.8,-65.9,54.7,-70.4,42.2C-74.9,29.7,-72.5,14.9,-72.1,0.3C-71.7,-14.3,-73.1,-28.7,-67,-38.3C-60.8,-48,-47.1,-52.9,-34.7,-55C-22.3,-57,-11.1,-56.1,2.1,-59.6C15.3,-63.2,30.6,-71.3,42.5,-69Z" transform="translate(100 100)" />
    </svg>
    <svg class="bubble-head-left" viewBox="0 0 200 200" xmlns="http://www.w3.org/2000/svg">
        <path fill="#FF0066" d="M42,-71.1C53,-66.4,59.4,-52.2,63.5,-38.8C67.6,-25.4,69.4,-12.7,72.2,1.7C75.1,16,79.1,32,72.8,41.6C66.5,51.3,50,54.6,36.1,61.2C22.3,67.7,11.2,77.5,-2.3,81.5C-15.7,85.4,-31.4,83.5,-45.2,76.9C-58.9,70.3,-70.8,59,-77.8,45.4C-84.8,31.8,-86.9,15.9,-83.3,2.1C-79.6,-11.7,-70.2,-23.4,-61.4,-33.9C-52.6,-44.3,-44.4,-53.5,-34.3,-58.8C-24.2,-64,-12.1,-65.3,1.7,-68.3C15.5,-71.2,31,-75.9,42,-71.1Z" transform="translate(100 100)" />
    </svg>
    <svg class="bubble-head-right" viewBox="0 0 200 200" xmlns="http://www.w3.org/2000/svg">
        <path fill="#FF0066" d="M34.6,-60.8C47.9,-52.2,63.8,-49.1,72.8,-39.9C81.9,-30.7,84.1,-15.3,80.9,-1.9C77.6,11.6,68.9,23.2,62.3,36.7C55.8,50.3,51.3,65.8,41.3,74.9C31.3,84.1,15.6,87,2.1,83.3C-11.3,79.6,-22.7,69.3,-36.5,62.2C-50.3,55.2,-66.5,51.5,-72.8,41.7C-79,31.8,-75.4,15.9,-74.8,0.4C-74.2,-15.2,-76.6,-30.4,-71.8,-42.9C-67.1,-55.4,-55.2,-65.1,-42,-73.8C-28.8,-82.4,-14.4,-89.8,-1.9,-86.6C10.7,-83.3,21.3,-69.3,34.6,-60.8Z" transform="translate(100 100)" />
    </svg>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <link rel="stylesheet" href="styles.css">

    <!-- jQuery -->
    <script src="https://code.jquery.com/jquery-3.6.1.min.js"
            integrity="sha256-o88AwQnZB+VDvE9tvIXrMQaPlFFSUTR+nldQm1LuPXQ="
            crossorigin="anonymous"></script>
    <!-- Bootstrap -->
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.bundle.min.js"></script>

    <!-- SweetAlert -->
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

    <title>Text to Image</title>
    <style>
        .loading-spinner {
            display: none;
            margin-top: 10px;
        }

        #result-img {
            display: none;
            margin-top: 20px;
            max-width: 100%;
        }

        .container {
            display: flex;
            flex-direction: column;
            align-items: center;
        }
    </style>
</head>
<body>
    <!-- Image generator -->
    <div class="container mt-5">
        <h1 class="text-center">Text to Image Generator</h1>
        <div class="form-group">
            <label for="text-input">Describe your favorite scene from the book:</label>
            <input type="text" id="text-input" class="form-control" placeholder="Enter description here..." />
        </div>

        <div class="container">
            <div class="dropdown">
                <button class="btn btn-secondary dropdown-toggle" type="button" id="dropdownMenuButton" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                    or choose title from existing books
                </button>
                <div class="dropdown-menu" aria-labelledby="dropdownMenuButton" id="dropdown-menu">
                    <!-- Items will be added here -->
                </div>
            </div>
        </div>
        <br />

        <button id="generate-btn" class="btn btn-light" type="button" onclick="TextToImage()">Generate Image</button>
        <div class="loading-spinner text-center">
            <i class="fas fa-spinner fa-spin fa-3x"></i>
            <p>Generating image, please wait...</p>
        </div>
        <div id="img">
            <img id="result-img" alt="Generated Image" />
        </div>
    </div>

  
    <script>
        $(document).ready(function () {
            showBooks();
        });

        var booksAPI = "https://localhost:7225/api/Books";
        var allBooks = [];
        let booksDict = [];

        function ajaxCall(method, url, data, successCallback, errorCallback) {
            $.ajax({
                type: method,
                url: url,
                data: data,
                success: successCallback,
                error: errorCallback
            });
        }
        // Add event listener to set input value when an item is clicked
        listItem.addEventListener('click', function () {
            document.getElementById('text-input').value = item;
        });

        function showBooks() {
            ajaxCall("GET", booksAPI, null, showAllBooks, errorToLoadBooks);
        }

        function showAllBooks(response) {
            allBooks = response;
            activateSearchBooksBar();
            populateDropdown(booksDict); // Update the dropdown menu after books are loaded
        }

        function errorToLoadBooks() {
            console.log("Error loading books");
        }

        function activateSearchBooksBar() {
            allBooks.forEach((book) => {
                let text = book.Title;
                booksDict.push(text);
            });
            console.log(booksDict);
            return booksDict;
        }

        function populateDropdown(items) {
            // Ensure items is an array
            if (!Array.isArray(items)) {
                console.error('Expected items to be an array but got:', items);
                return;
            }

            // Get reference to the dropdown menu
            var dropdownMenu = document.getElementById('dropdown-menu');

            // Clear existing items
            dropdownMenu.innerHTML = '';

            // Add new items
            items.forEach(item => {
                var listItem = document.createElement('a');
                listItem.className = 'dropdown-item';
                listItem.href = '#';
                listItem.textContent = item;

                // Add event listener to set input value when an item is clicked
                listItem.addEventListener('click', function () {
                    document.getElementById('text-input').value = item;
                });

                dropdownMenu.appendChild(listItem);
            });
        
        }

        // Example usage
        populateDropdown(booksDict);














        // Text to Image
        async function queryTEXTtoIMG(text) {
            const response = await fetch(
                "https://api-inference.huggingface.co/models/CompVis/stable-diffusion-v1-4",
                {
                    headers: { Authorization: "Bearer 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" },
                    method: "POST",
                    body: JSON.stringify({ inputs: text }),
                }
            );
            if (!response.ok) {
                throw new Error("Image generation failed. Please try again.");
            }
            return response.blob();
        }

        async function TextToImage() {
            const textInput = document.getElementById("text-input").value;
            const loadingSpinner = document.querySelector(".loading-spinner");
            const resultImg = document.getElementById("result-img");

            if (!textInput) {
                alert("Please enter a description.");
                return;
            }

            loadingSpinner.style.display = "block";
            resultImg.style.display = "none";

            try {
                const imageBlob = await queryTEXTtoIMG(textInput);
                const imageUrl = URL.createObjectURL(imageBlob);
                resultImg.src = imageUrl;
                resultImg.style.display = "block";
            } catch (error) {
                alert(error.message);
            } finally {
                loadingSpinner.style.display = "none";
            }
        }
    </script>
</body>
</html>

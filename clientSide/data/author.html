<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="utf-8" />
    <title>Authors - Book Store</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.4.1/dist/css/bootstrap.min.css" integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous">
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Reddit+Mono:wght@200..900&display=swap" rel="stylesheet">
    <!-- Custom CSS -->
    <link rel="stylesheet" href="authors.css">
    <!--JQuery-->
    <script src="https://code.jquery.com/jquery-3.6.1.min.js" integrity="sha256-o88AwQnZB+VDvE9tvIXrMQaPlFFSUTR+nldQm1LuPXQ=" crossorigin="anonymous"></script>
    <!-- sweet aleret -->
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script src="https://cdn.jsdelivr.net/npm/@microsoft/signalr@7.0.0/dist/browser/signalr.min.js"></script>

</head>
<body>

    <header class="bg-dark text-white py-2 fixed-top">
        <div class="container">
            <nav class="navbar navbar-expand-lg navbar-dark sticky-top">

                <a class="navbar-brand" id="nav-title">Book Store</a>

                <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar">
                    <span class="navbar-toggler-icon"></span>
                </button>

                <div class="collapse navbar-collapse" id="navbar">
                    <ul class="navbar-nav ml-auto">
                        <li class="nav-item"><a class="nav-link text-white" href="HTMLPage1.html">Home</a></li>
                        <li class="nav-item adminPage"><a class="nav-link text-white " href="adminPage.html">Admin Page</a></li>
                        <li class="nav-item myBooks"><a class="nav-link text-white " href="myBooks.html">My Books</a></li>
                        <li class="nav-item"><a class="nav-link text-white" href="#">Authors</a></li>
                        <li class="nav-item"><a class="nav-link text-white" href="TheGoodBookClub.html">Books Clubs</a></li>
                        <li class="nav-item games"><a class="nav-link text-white games" href="games.html">games</a></li>
                        <li class="nav-item loginBox"><a class="nav-link text-white login">login</a></li>
                        <li class="nav-item userNameBox">
                            <a class="nav-link text-white userName"></a>
                        </li>
                        <li class="nav-item logoutBox"><a class="nav-link pink whiteHover logout" style="color: #ff0083">logout</a></li>
                        <li class="nav-item dropdown requestBox message-box">
                            <button class="btn btn-dark dropdown-toggle" type="button" id="dropdownMenuButton" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                <span id="message-count" class="badge">0</span> <!-- Badge -->
                                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-envelope" viewBox="0 0 16 16">
                                    <path d="M0 4a2 2 0 0 1 2-2h12a2 2 0 0 1 2 2v8a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2zm2-1a1 1 0 0 0-1 1v.217l7 4.2 7-4.2V4a1 1 0 0 0-1-1zm13 2.383-4.708 2.825L15 11.105zm-.034 6.876-5.64-3.471L8 9.583l-1.326-.795-5.64 3.47A1 1 0 0 0 2 13h12a1 1 0 0 0 .966-.741M1 11.105l4.708-2.897L1 5.383z" />
                                </svg>
                            </button>
                            <div class="dropdown-menu dropdown-menu-dark dropdown-menu-right" aria-labelledby="dropdownMenuButton">
                                <div class="send"> </div>
                                <div class="got"> </div>
                            </div>
                        </li>
                    </ul>
                </div>
            </nav>
        </div>
    </header>
    <section>
        <div class="title">
            <h1>All Of Our Authors</h1>
        </div>
    </section>
    <div class="container booksbyAuthor-body mt-4">
        <label for="authorsDataList" class="form-label pink">Search author: </label>
        <input class="form-control" list="authorsNames" id="authorsNamesInput" placeholder="Type author name to search...">
        <datalist id="authorsNames">
        </datalist>
        <hr class="pink" />
        <div class="author-details"></div>
        <h2 class="text-center text-black authorName"></h2>
        <div id="authors-books" class="row"></div>
    </div>
    <div id="overlay" class=""></div>
    <div id="loader-wrapper"><div id="loader"></div></div>
    <!-- Bootstrap JS -->
    <script src="https://code.jquery.com/jquery-3.4.1.slim.min.js" integrity="sha384-J6qa4849blE2+poT4WnyKhv5vZF5SrPo0iEjwBvKU7imGFAV0wwj1yYfoRSJoZ+n" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js" integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.4.1/dist/js/bootstrap.min.js" integrity="sha384-wfSDF2E50Y2D1uUdj0O3uMBJnjuUD4Ih7YwaYd1iqfktj0Uod8GCExl3Og8ifwB6" crossorigin="anonymous"></script>
    <!-- JQuary -->
    <script src="https://code.jquery.com/jquery-3.6.1.min.js"
            integrity="sha256-o88AwQnZB+VDvE9tvIXrMQaPlFFSUTR+nldQm1LuPXQ="
            crossorigin="anonymous"></script>

    <script>
        var usersAPI = "https://localhost:7225/api/IUsers";
        var booksAPI = "https://localhost:7225/api/Books";
        var authorsAPI = "https://localhost:7225/api/Authors";
        var allAuthors = '';
        let messageCount = 0;

        $(document).ready(function () {

            checkForLoginUser();

            showAuthors();

            $('.logout').click(logoutUser);

            updateMessageCount(0);
        });
        // search author by name
        document.addEventListener('DOMContentLoaded', () => {
            const searchInput = document.getElementById('authorsNamesInput');
            var selectedAuthor = "";

            searchInput.addEventListener('input', () => {
                const selectedValue = searchInput.value;
                allAuthors.forEach(author => {
                    if (author.name === selectedValue) {
                        selectedAuthor = author;
                    }
                });
                if (selectedAuthor == "") { $(".author-details").html(''); } // If no author name was selected
                else {
                    showSearchedAuthor(selectedAuthor);
                    loadAthourBooks(selectedAuthor.id);
                    selectedAuthor = "";
                }
            });
        });
        //---------------
        function showSearchedAuthor(author) {
            var html = "";
            html += `
                                <div class=''>
                                    <div class='card-body'>
                                        <h2 class='card-text'>${author.name}</h2>`;
            if (author.dateOfBirth == undefined || author.dateOfBirth == "") { }
            else {
                html += `<p class='card-text'><strong>Born:</strong> ${author.dateOfBirth}</p>`
            }
            if (author.dateOfDeath == undefined || author.dateOfDeath == "") { }
            else {
                html += `<p class='card-text'><strong>Died:</strong> ${author.dateOfDeath}</p>`
            }
            if (author.age == undefined || author.age == "") { }
            else {
                html += `<p class='card-text'><strong>Age:</strong> ${author.age}</p>`
            }
            if (author.nationality == undefined || author.nationality == "") { }
            else {
                html += `<p class='card-text'><strong>Nationality:</strong> ${author.nationality}</p>`
            }
            if (author.notableWork == undefined || author.notableWork == "") { }
            else {
                html += `<p class='card-text'><strong>Notable Work:</strong> ${author.notableWork}</p>`
            }
            if (author.awards == undefined || author.awards == "") { }
            else {
                html += `<p class='card-text'><strong>Awards:</strong> ${author.awards}</p>`
            }
            if (author.description == undefined || author.description == "") { }
            else {
                html += `<p class='card-text'><strong>Description:</strong> ${author.description}</p>`
            }
            html += `  <h4 class='authorBooksTitle'></h4>  <div class="row authour-books"></div> </div>
                                </div>`;
            $(".author-details").html(html)
        }
        // load all the books by author
        function loadAthourBooks(selectedAuthor) {

            ajaxCall("GET", authorsAPI + `/findBookByAuthor/?authorId=${selectedAuthor}`, null, successToLoadBooks, errorToLoadAuthors)
        }

        function successToLoadBooks(authorBooks) {
            var html = "";
            const rating = stars => '★★★★★☆☆☆☆☆'.slice(5 - stars, 10 - stars);

            document.querySelector(".authorBooksTitle").innerHTML += 'Books By ' + authorBooks[0].FirstAuthorName + ':';

            authorBooks.forEach((book) => {

                html += `
                            <div class='col-md-3'>
                                <div class='card mb-4 book-card'>
                                    <img src='${book.SmallThumbnail}' class='card-img-top' alt='Book'>
                                    <div class='card-body w-100'>
                                        <h6 class='card-title'>${book.Title}</h6>
                                        <p id='pinkStars'>${rating(book.Rating)}  ${(book.Rating).toFixed(1)}</p>
                                        <span class='card-text'>${book.Price}$</span></div></div></div>`;
            })
            $(".authour-books").html(html);
        }

        function showAuthors() {
            if (allAuthors.length == 0) {
                ajaxCall("GET", authorsAPI, null, authorsToShow, errorToLoadAuthors);
            } else {
                authorsToShow(allAuthors);
            }
        }

        function errorToLoadAuthors(err) {
            console.log(err);
        }

        function authorsToShow(authors) {
            var authorNameSearchBar = "";

            allAuthors = authors;

            allAuthors.forEach((author) => { authorNameSearchBar += `<option value='${author.name}'>` })

            $("#authorsNames").html(authorNameSearchBar);
        }
        function updateMessageCount(count) {
            const badge = document.getElementById("message-count");

            // Always show the count, even if it's 0
            badge.textContent = count;
        }

        ///
        function showBooks() { };
        function showMyBooks(){ };
        function closeBookInfo(){ };
    </script>
    <!-- shared function -->
    <script src="sharedFunc.js"></script>
</body>
</html>
